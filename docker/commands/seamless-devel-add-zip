set -u -e

# - Current directory is mounted to /cwd, and the command is executed there

[ $(id -u) != 1000 ] && echo 'WARNING: The Seamless container will run as user jovyan (ID 1000), which is not the same as your current user ID '$(id -u)'. When reading/writing fails for /cwd, check that '$(pwd) 'gives enough file permissions.' >> /dev/stderr

seamlessdir=`python3 -c 'import seamless,os;print(os.path.dirname(seamless.__file__))'`/../
zipfile_dir=`python3 -c 'import os,sys;print(os.path.abspath(os.path.dirname(sys.argv[1])))' $1`
zipfile_name=${1##*/}

cd ${zipfile_dir}

docker run --rm \
  -v $seamlessdir:/seamless \
  -e "PYTHONPATH=/seamless" \
  --network=host \
  -v `pwd`:/cwd \
  --workdir /cwd \
  -u jovyan \
  seamless-devel python3 /home/jovyan/seamless-scripts/add-zip.py ${zipfile_name}
