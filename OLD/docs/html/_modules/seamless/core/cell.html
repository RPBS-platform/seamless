
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>seamless.core.cell &#8212; seamless 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for seamless.core.cell</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module containing the Cell class.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">dtypes</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">find_return_in_scope</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Managed</span>
<span class="kn">from</span> <span class="nn">.resource</span> <span class="k">import</span> <span class="n">Resource</span>

<span class="k">class</span> <span class="nc">CellLike</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for cells and contexts</span>
<span class="sd">    CellLikes are captured by context.cells&quot;&quot;&quot;</span>
    <span class="n">_like_cell</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">Managed</span><span class="p">,</span> <span class="n">CellLike</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Default class for cells.</span>

<span class="sd">Cells contain all the state in text form</span>

<span class="sd">Cells can be connected to inputpins, editpins, and other cells.</span>
<span class="sd">``cell.connect(pin)`` connects a cell to an inputpin or editpin</span>

<span class="sd">Output pins and edit pins can be connected to cells.</span>
<span class="sd">``pin.connect(cell)`` connects an outputpin or editpin to a cell</span>

<span class="sd">Use ``Cell.set()`` to set a cell&#39;s value.</span>

<span class="sd">Use ``Cell.value`` to get its value.</span>

<span class="sd">Use ``Cell.status()`` to get its status.</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="n">_dtype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># data, always in text format</span>
    <span class="n">_data_last</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_error_message</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_dependent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_incoming_connections</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_outgoing_connections</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_resource</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_preliminary</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">naming_pattern</span><span class="o">=</span><span class="s2">&quot;cell&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">.macro</span> <span class="k">import</span> <span class="n">get_macro_mode</span>
        <span class="kn">from</span> <span class="nn">.context</span> <span class="k">import</span> <span class="n">get_active_context</span>
        <span class="k">assert</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">check_registered</span><span class="p">(</span><span class="n">dtype</span><span class="p">),</span> <span class="n">dtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resource</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_macro_mode</span><span class="p">():</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="n">get_active_context</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">_add_new_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">naming_pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_destroyed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Cell has been destroyed&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dependent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indicate if the cell is dependent.</span>

<span class="sd">        Property is true if the cell has a hard incoming connection,</span>
<span class="sd">        e.g. the output of a worker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependent</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_object</span><span class="p">,</span><span class="n">propagate</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">preliminary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic method to update cell; returns True if cell was changed&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text_or_object</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_set</span><span class="p">(</span><span class="n">text_or_object</span><span class="p">,</span>
                <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">,</span><span class="n">trusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="n">preliminary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_set</span><span class="p">(</span><span class="n">text_or_object</span><span class="p">,</span>
                <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">,</span><span class="n">trusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="n">preliminary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update cell data from Python code in the main thread.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">text_or_object</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">text_or_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="kn">import</span> <span class="nn">seamless</span>
        <span class="n">seamless</span><span class="o">.</span><span class="n">run_work</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a file from filename.</span>
<span class="sd">        Also sets the filename as a resource:</span>
<span class="sd">          When the context is saved and re-loaded, the cell is again loaded</span>
<span class="sd">          from file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">frames_back</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fromlibfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: document&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">fromlibfile</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span> \
                    <span class="ow">and</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_last</span> <span class="ow">or</span>
                         <span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">or</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_last</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;Check if we can parse the text&quot;&quot;&quot;</span>
            <span class="n">dtypes</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">trusted</span><span class="o">=</span><span class="n">trusted</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_last</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preliminary</span> <span class="o">=</span> <span class="n">preliminary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">propagate</span><span class="p">:</span>
                    <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
                    <span class="n">manager</span><span class="o">.</span><span class="n">update_from_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_object_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">object_</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_object</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Construct the object:</span>
<span class="sd">             If the object is already of the correct type,</span>
<span class="sd">               then constructed_object is object_</span>
<span class="sd">             Some datatypes (i.e. silk) can construct the object from</span>
<span class="sd">              heterogenous input</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">dtypes</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">ConstructionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">object_</span><span class="p">)</span>
            <span class="c1"># Normally no error here...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preliminary</span> <span class="o">=</span> <span class="n">preliminary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_object</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">propagate</span><span class="p">:</span>
                    <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
                    <span class="n">manager</span><span class="o">.</span><span class="n">update_from_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forces a cell update, even though the value stays the same</span>
<span class="sd">        This triggers all workers that are connected to the cell&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">update_from_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Invoked when cell data is updated by a worker or an alias.&quot;&quot;&quot;</span>
        <span class="c1">#result = self._text_set(data, propagate=False, trusted=True, preliminary=False)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">,</span><span class="n">preliminary</span><span class="o">=</span><span class="n">preliminary</span><span class="p">)</span> <span class="c1">#for now, workers can also set with non-text...</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Break ane existing connection between the cell and a worker&#39;s input pin.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect the cell to a worker&#39;s input pin.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The cell&#39;s data type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The cell&#39;s data in text format.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The cell&#39;s data as Python object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">trusted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The cell&#39;s current status.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The cell&#39;s current error message.</span>

<span class="sd">        Returns None is there is no error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span>

    <span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.worker</span> <span class="k">import</span> <span class="n">OutputPinBase</span>
        <span class="k">if</span> <span class="n">incoming</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependent</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="p">(</span><span class="n">OutputPinBase</span><span class="p">,</span> <span class="n">Cell</span><span class="p">))</span> \
              <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Signal</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                 <span class="s2">&quot;Cell is already the output of another worker&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="p">(</span><span class="n">OutputPinBase</span><span class="p">,</span> <span class="n">Cell</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dependent</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_incoming_connections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outgoing_connections</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.worker</span> <span class="k">import</span> <span class="n">OutputPinBase</span>
        <span class="k">if</span> <span class="n">incoming</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="p">(</span><span class="n">OutputPinBase</span><span class="p">,</span> <span class="n">Cell</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dependent</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_incoming_connections</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outgoing_connections</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_set_error_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">error_message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">INVALID</span>
            <span class="k">if</span> <span class="n">error_message</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span> <span class="o">=</span> <span class="n">error_message</span>

    <span class="k">def</span> <span class="nf">add_macro_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destroyed</span><span class="p">()</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">add_macro_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_macro_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">):</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">remove_macro_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unregister_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">remove_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">remove_listeners_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">remove_macro_listeners_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">remove_observers_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the cell from its parent context&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1">#print(&quot;CELL DESTROY&quot;, self)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unregister_listeners</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PythonCell</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell containing Python code.</span>

<span class="sd">    Python cells have dtype (&quot;text&quot;, &quot;code&quot;, &quot;python&quot;)</span>
<span class="sd">    Python cells may contain either a code block or a function.</span>
<span class="sd">    In both cases, the cell contains text, not a Python code object!</span>

<span class="sd">    Workers that are connected to it may require either a code block or a</span>
<span class="sd">     function.</span>
<span class="sd">    Mismatch between the two is not a problem, unless:</span>
<span class="sd">          Connected workers have conflicting block/function requirements</span>
<span class="sd">        OR</span>
<span class="sd">            A function is required (typically, true for transformers)</span>
<span class="sd">          AND</span>
<span class="sd">            The cell contains a code block</span>
<span class="sd">          AND</span>
<span class="sd">            The code block contains no return statement</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CodeTypes</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;CodeTypes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ANY&#39;</span><span class="p">,</span> <span class="s1">&#39;FUNCTION&#39;</span><span class="p">,</span> <span class="s1">&#39;BLOCK&#39;</span><span class="p">))</span>
    <span class="n">_dtype</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

    <span class="n">_code_type</span> <span class="o">=</span> <span class="n">CodeTypes</span><span class="o">.</span><span class="n">ANY</span>
    <span class="n">_required_code_type</span> <span class="o">=</span> <span class="n">CodeTypes</span><span class="o">.</span><span class="n">ANY</span>

    <span class="k">def</span> <span class="nf">_text_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;Check if the code is valid Python syntax&quot;&quot;&quot;</span>
            <span class="n">ast_tree</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">PyCF_ONLY_AST</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span><span class="p">:</span>
                <span class="k">raise</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_function</span> <span class="o">=</span> <span class="p">(</span>
             <span class="nb">len</span><span class="p">(</span><span class="n">ast_tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
             <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast_tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># If this cell requires a function, but wasn&#39;t provided</span>
            <span class="c1">#  with a def block</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_function</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">:</span>
                <span class="c1"># Look for return node in AST</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">find_return_in_scope</span><span class="p">(</span><span class="n">ast_tree</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">exception</span> <span class="o">=</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                     <span class="s2">&quot;Block must contain return statement(s)&quot;</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">trusted</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">exception</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">exception</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">return</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">exception</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_code_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">FUNCTION</span> <span class="k">if</span> <span class="n">is_function</span> <span class="k">else</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">BLOCK</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preliminary</span> <span class="o">=</span> <span class="n">preliminary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">propagate</span><span class="p">:</span>
                    <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
                    <span class="n">manager</span><span class="o">.</span><span class="n">update_from_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_object_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">strip_source</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Try to retrieve the source code</span>
<span class="sd">            Will only work if object_ is a function object</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">object_</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Python object must be a function&quot;</span><span class="p">)</span>

            <span class="n">code</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">strip_source</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_error_state</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_code_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">FUNCTION</span>
            <span class="n">oldcode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">code</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preliminary</span> <span class="o">=</span> <span class="n">preliminary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trusted</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">propagate</span><span class="p">:</span>
                    <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_manager</span><span class="p">()</span>
                    <span class="n">manager</span><span class="o">.</span><span class="n">update_from_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">code</span> <span class="o">!=</span> <span class="n">oldcode</span>

    <span class="k">def</span> <span class="nf">_on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">):</span>
        <span class="n">exc1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Cannot connect to </span><span class="si">%s</span><span class="s2">: worker requires a code function</span>
<span class="s2">        whereas other connected workers require a code block&quot;&quot;&quot;</span>
        <span class="n">exc2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Cannot connect to </span><span class="si">%s</span><span class="s2">: worker requires a code block</span>
<span class="s2">        whereas other connected worker require a code function&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">incoming</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">BLOCK</span> <span class="ow">and</span> \
                    <span class="n">worker</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exc1</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">worker</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">FUNCTION</span> <span class="ow">and</span> \
                    <span class="n">worker</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">BLOCK</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exc2</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">worker</span><span class="p">))</span>

        <span class="n">Cell</span><span class="o">.</span><span class="n">_on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">incoming</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">_required_code_type</span>

    <span class="k">def</span> <span class="nf">_on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">):</span>
        <span class="n">Cell</span><span class="o">.</span><span class="n">_on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">incoming</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outgoing_connections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_required_code_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeTypes</span><span class="o">.</span><span class="n">ANY</span>


<span class="k">class</span> <span class="nc">Signal</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A cell that does not contain any data</span>
<span class="sd">    When a signal is set, it is propagated as fast as possible:</span>
<span class="sd">      - If set from the main thread: immediately. Downstream workers are</span>
<span class="sd">         notified and activated (if synchronous) before set() returns</span>
<span class="sd">      - If set from another thread: as soon as run_work is called. Then,</span>
<span class="sd">         Downstream workers are notified and activated before any other</span>
<span class="sd">         non-signal notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">naming_pattern</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;signal&quot;</span>
        <span class="n">Managed</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">.macro</span> <span class="k">import</span> <span class="n">get_macro_mode</span>
        <span class="kn">from</span> <span class="nn">.context</span> <span class="k">import</span> <span class="n">get_active_context</span>

        <span class="k">if</span> <span class="n">get_macro_mode</span><span class="p">():</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="n">get_active_context</span><span class="p">()</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">_add_new_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">naming_pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">StatusFlags</span><span class="o">.</span><span class="n">OK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">seamless</span>
        <span class="n">seamless</span><span class="o">.</span><span class="n">run_work</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;fromfile&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">_object_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">preliminary</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">add_macro_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private; raises an error&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">remove_macro_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro_object</span><span class="p">,</span> <span class="n">macro_arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private; raises an error&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the cell from its parent context&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1">#print(&quot;CELL DESTROY&quot;, self)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unregister_listeners</span><span class="p">()</span>
        <span class="n">Managed</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CsonCell</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell in CoffeeScript Object Notation (CSON) format</span>
<span class="sd">    When necessary, the contents of a CSON cell are automatically converted</span>
<span class="sd">    to JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the data to JSON and returns the dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="kn">from</span> <span class="nn">..dtypes.cson</span> <span class="k">import</span> <span class="n">cson2json</span>
        <span class="k">return</span> <span class="n">cson2json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Invoked when cell data is updated by a worker.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">,</span> <span class="n">preliminary</span><span class="o">=</span><span class="n">preliminary</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ArrayCell</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell that contains a NumPy array&quot;&quot;&quot;</span>
    <span class="n">_store</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">set_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specify a store to be bound to the data, i.e. to hold an additional</span>
<span class="sd">         copy of the data in a different form</span>
<span class="sd">        Calling the store&#39;s bind() method will (re-)bind the data if it has</span>
<span class="sd">         changed, else it is a no-op</span>
<span class="sd">        mode:</span>
<span class="sd">            &quot;GL&quot;: stores the data as an OpenGL buffer</span>
<span class="sd">            &quot;GLTex&quot;: stores the data as an OpenGL texture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GL&quot;</span><span class="p">,</span> <span class="s2">&quot;GLTex&quot;</span><span class="p">),</span> <span class="n">mode</span>
        <span class="kn">from</span> <span class="nn">..dtypes.gl</span> <span class="k">import</span> <span class="n">GLStore</span><span class="p">,</span> <span class="n">GLTexStore</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;GL&quot;</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_store</span><span class="p">,</span> <span class="n">GLStore</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;GLTex&quot;</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_store</span><span class="p">,</span> <span class="n">GLTexStore</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;GL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="o">=</span> <span class="n">GLStore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;GLTex&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="o">=</span> <span class="n">GLTexStore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_store</span><span class="o">.</span><span class="n">set_dirty</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_store_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_object</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">propagate</span><span class="p">,</span><span class="n">preliminary</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">text_or_object</span><span class="p">,</span>
          <span class="n">propagate</span><span class="o">=</span><span class="n">propagate</span><span class="p">,</span><span class="n">preliminary</span><span class="o">=</span><span class="n">preliminary</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_store</span><span class="o">.</span><span class="n">set_dirty</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_destroyed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: leads to segfault because there is no OpenGL context</span>
            <span class="c1">#  but omitting it is a GPU memory leak...</span>
            <span class="c1">#self._store.destroy()</span>
            <span class="k">pass</span> <span class="c1">###</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

<span class="n">_handlers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">):</span> <span class="n">PythonCell</span><span class="p">,</span>
    <span class="s2">&quot;signal&quot;</span><span class="p">:</span> <span class="n">Signal</span><span class="p">,</span>
    <span class="s2">&quot;cson&quot;</span><span class="p">:</span> <span class="n">CsonCell</span><span class="p">,</span>
    <span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="n">ArrayCell</span>
<span class="p">}</span>


<div class="viewcode-block" id="cell"><a class="viewcode-back" href="../../../coreapi.html#seamless.cell">[docs]</a><span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates and returns a Cell object.</span>

<span class="sd">{0}</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>

<span class="sd">dtype: string or tuple of strings</span>
<span class="sd">    specifies the data type of the cell.</span>
<span class="sd">    As of seamless 0.1, the following data types are understood:</span>

<span class="sd">    -   &quot;int&quot;, &quot;float&quot;, &quot;bool&quot;, &quot;str&quot;, &quot;json&quot;, &quot;cson&quot;, &quot;array&quot;, &quot;signal&quot;</span>
<span class="sd">    -   &quot;text&quot;, (&quot;text&quot;, &quot;code&quot;, &quot;python&quot;), (&quot;text&quot;, &quot;code&quot;, &quot;ipython&quot;)</span>
<span class="sd">    -   (&quot;text&quot;, &quot;code&quot;, &quot;silk&quot;), (&quot;text&quot;, &quot;code&quot;, &quot;slash-0&quot;)</span>
<span class="sd">    -   (&quot;text&quot;, &quot;code&quot;, &quot;vertexshader&quot;), (&quot;text&quot;, &quot;code&quot;, &quot;fragmentshader&quot;),</span>
<span class="sd">    -   (&quot;text&quot;, &quot;html&quot;),</span>
<span class="sd">    -   (&quot;json&quot;, &quot;seamless&quot;, &quot;transformer_params&quot;),</span>
<span class="sd">        (&quot;cson&quot;, &quot;seamless&quot;, &quot;transformer_params&quot;),</span>
<span class="sd">    -   (&quot;json&quot;, &quot;seamless&quot;, &quot;reactor_params&quot;),</span>
<span class="sd">        (&quot;cson&quot;, &quot;seamless&quot;, &quot;reactor_params&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">cell_cls</span> <span class="o">=</span> <span class="n">Cell</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">_handlers</span><span class="p">:</span>
        <span class="n">cell_cls</span> <span class="o">=</span> <span class="n">_handlers</span><span class="p">[</span><span class="n">dtype</span><span class="p">]</span>

    <span class="n">newcell</span> <span class="o">=</span> <span class="n">cell_cls</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newcell</span></div>
<span class="n">cell</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Cell</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pythoncell</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Factory function for a PythonCell object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">((</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">))</span>
<span class="n">pythoncell</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">PythonCell:&quot;</span> <span class="o">+</span> <span class="n">PythonCell</span><span class="o">.</span><span class="n">__doc__</span>

<span class="k">def</span> <span class="nf">arraycell</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Factory function for a ArrayCell object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">(</span><span class="s2">&quot;array&quot;</span><span class="p">)</span>
<span class="n">arraycell</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">ArrayCell:&quot;</span> <span class="o">+</span> <span class="n">ArrayCell</span><span class="o">.</span><span class="n">__doc__</span>

<span class="k">def</span> <span class="nf">csoncell</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Factory function for a CsonCell object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">(</span><span class="s2">&quot;cson&quot;</span><span class="p">)</span>
<span class="n">csoncell</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">CsonCell:&quot;</span> <span class="o">+</span> <span class="n">CsonCell</span><span class="o">.</span><span class="n">__doc__</span>

<span class="k">def</span> <span class="nf">signal</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Factory function for a Signal object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">(</span><span class="s2">&quot;signal&quot;</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Signal:&quot;</span> <span class="o">+</span> <span class="n">Signal</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">seamless</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_example.html">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../coreapi.html">Seamless core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../library.html">Standard library</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../seamless.html">seamless</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, Sjoerd de Vries.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>